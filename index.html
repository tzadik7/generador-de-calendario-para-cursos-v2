<!-- GENERADOR DE CALENDARIOS M√âDICOS - C√ìDIGO COMPLETO -->
<!-- VERSI√ìN FINAL CON TODAS LAS FUNCIONALIDADES -->
<!-- Copiar y pegar TODO este c√≥digo en Google Sites -->

<div id="calendario-generator-app">
<style>
    #calendario-generator-app {
        font-family: 'Google Sans', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .header-section {
        background: linear-gradient(135deg, #4285f4 0%, #34a853 100%);
        color: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(66, 133, 244, 0.3);
    }

    .header-section h1 {
        font-size: 2.5em;
        margin: 0 0 10px 0;
        font-weight: 400;
    }

    .header-section p {
        font-size: 1.2em;
        margin: 0;
        opacity: 0.9;
    }

    .form-container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
    }

    .form-title {
        color: #1a73e8;
        margin-bottom: 25px;
        font-size: 1.8em;
        font-weight: 400;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .input-wrapper {
        display: flex;
        flex-direction: column;
    }

    .input-wrapper label {
        font-weight: 500;
        color: #202124;
        margin-bottom: 8px;
        font-size: 1.1em;
    }

    .input-wrapper input, .input-wrapper select {
        padding: 12px 16px;
        border: 1px solid #dadce0;
        border-radius: 8px;
        font-size: 1em;
        transition: all 0.2s ease;
        font-family: inherit;
    }

    .input-wrapper input:focus, .input-wrapper select:focus {
        outline: none;
        border-color: #1a73e8;
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    .button-container {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .google-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 24px;
        font-size: 1em;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: none;
        letter-spacing: 0.25px;
        font-family: 'Google Sans', sans-serif;
        min-width: 120px;
    }

    .btn-primary {
        background: #1a73e8;
        color: white;
    }

    .btn-primary:hover {
        background: #1557b0;
        box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
    }

    .btn-secondary {
        background: #34a853;
        color: white;
    }

    .btn-secondary:hover {
        background: #2d8f47;
        box-shadow: 0 2px 8px rgba(52, 168, 83, 0.3);
    }

    .btn-success {
        background: #fbbc04;
        color: #202124;
    }

    .btn-success:hover {
        background: #f9ab00;
        box-shadow: 0 2px 8px rgba(251, 188, 4, 0.3);
    }

    .saved-section {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
    }

    .saved-section h2 {
        color: #1a73e8;
        margin-bottom: 20px;
        font-size: 1.8em;
        font-weight: 400;
    }

    .course-item {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 4px solid #1a73e8;
        transition: all 0.3s ease;
    }

    .course-item:hover {
        background: #f1f3f4;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .course-item h3 {
        color: #202124;
        margin-bottom: 10px;
        font-weight: 500;
    }

    .course-item p {
        color: #5f6368;
        margin-bottom: 15px;
        line-height: 1.5;
    }

    .course-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .small-btn {
        padding: 8px 16px;
        font-size: 0.9em;
        border: 1px solid #dadce0;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        color: #1a73e8;
        font-weight: 500;
    }

    .small-btn:hover {
        background: #1a73e8;
        color: white;
        border-color: #1a73e8;
    }

    .small-btn.delete {
        color: #ea4335;
        border-color: #ea4335;
    }

    .small-btn.delete:hover {
        background: #ea4335;
        color: white;
    }

    .calendar-display {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border: 1px solid #e0e0e0;
        display: none;
    }

    .calendar-header {
        text-align: center;
        margin-bottom: 30px;
    }

    .calendar-header h1 {
        color: #1a73e8;
        font-size: 2.2em;
        margin-bottom: 10px;
        font-weight: 400;
    }

    .calendar-info {
        color: #5f6368;
        font-size: 1.1em;
        line-height: 1.6;
    }

    .important-dates {
        background: #e8f0fe;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        border-left: 4px solid #1a73e8;
    }

    /* ESTILOS PARA VISTAS M√öLTIPLES */
    .view-controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .view-btn {
        padding: 10px 20px;
        border: 2px solid #1a73e8;
        border-radius: 25px;
        background: white;
        color: #1a73e8;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .view-btn.active {
        background: #1a73e8;
        color: white;
    }

    .view-btn:hover {
        background: #1a73e8;
        color: white;
    }

    .week-info {
        background: #f0f8ff;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        border-left: 4px solid #4285f4;
        text-align: center;
    }

    .week-numbers {
        display: flex;
        justify-content: space-around;
        margin-top: 10px;
    }

    .week-number {
        background: white;
        padding: 8px 15px;
        border-radius: 20px;
        font-weight: bold;
        color: #1a73e8;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Vista por d√≠a */
    .day-view .month-block {
        margin-bottom: 30px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .day-view .month-title {
        background: linear-gradient(135deg, #1a73e8, #4285f4);
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 1.4em;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .day-view .calendar-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }

    .day-view .calendar-table td {
        padding: 12px 15px;
        border: 1px solid #e0e0e0;
        vertical-align: middle;
        transition: all 0.2s ease;
    }

    .day-view .calendar-table td:hover {
        background: #f8f9fa;
    }

    .day-view .date-column {
        font-weight: 500;
        width: 180px;
        background: #f8f9fa;
        border-right: 2px solid #e0e0e0;
        color: #202124;
    }

    .day-view .activity-column {
        font-size: 0.95em;
        position: relative;
    }

    /* Vista por semana */
    .week-view {
        display: none;
    }

    .week-view .week-container {
        background: white;
        border-radius: 12px;
        margin-bottom: 20px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .week-view .week-header {
        background: linear-gradient(135deg, #34a853, #4caf50);
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 1.3em;
        font-weight: 500;
    }

    .week-view .week-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 1px;
        background: #e0e0e0;
    }

    .week-view .day-cell {
        background: white;
        padding: 15px;
        min-height: 120px;
        display: flex;
        flex-direction: column;
    }

    .week-view .day-header {
        font-weight: bold;
        color: #1a73e8;
        margin-bottom: 8px;
        font-size: 0.9em;
    }

    .week-view .day-activity {
        font-size: 0.8em;
        padding: 4px 8px;
        border-radius: 6px;
        margin-bottom: 4px;
        text-align: center;
    }

    /* Vista por mes */
    .month-view {
        display: none;
    }

    .month-view .month-overview {
        background: white;
        border-radius: 12px;
        margin-bottom: 20px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .month-view .month-overview-header {
        background: linear-gradient(135deg, #fbbc04, #f9ab00);
        color: #202124;
        padding: 15px;
        text-align: center;
        font-size: 1.3em;
        font-weight: 500;
    }

    .month-view .activity-summary {
        padding: 20px;
    }

    .month-view .activity-count {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .month-view .count-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid #1a73e8;
    }

    .month-view .count-number {
        font-size: 2em;
        font-weight: bold;
        color: #1a73e8;
    }

    .month-view .count-label {
        color: #5f6368;
        margin-top: 5px;
    }

    /* Colores para diferentes m√≥dulos */
    .mod-1 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
    .mod-2 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
    .mod-3 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
    .mod-4 { background: linear-gradient(135deg, #ff8a80 0%, #ff80ab 100%); }
    .mod-5 { background: linear-gradient(135deg, #81c784 0%, #aed581 100%); }
    .mod-6 { background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%); }
    .mod-7 { background: linear-gradient(135deg, #ba68c8 0%, #ab47bc 100%); }
    .mod-8 { background: linear-gradient(135deg, #ffb74d 0%, #ffa726 100%); }
    .mod-9 { background: linear-gradient(135deg, #4db6ac 0%, #26a69a 100%); }
    .mod-10 { background: linear-gradient(135deg, #f06292 0%, #ec407a 100%); }
    .intervention { background: linear-gradient(135deg, #ff7043 0%, #ff5722 100%); color: white; font-weight: 500; }
    .workshop { background: linear-gradient(135deg, #5c6bc0 0%, #3f51b5 100%); color: white; font-weight: 500; }
    .evaluation { background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%); color: white; font-weight: 500; }
    .practice { background: linear-gradient(135deg, #42a5f5 0%, #2196f3 100%); color: white; font-weight: 500; }
    .induction { background: linear-gradient(135deg, #ab47bc 0%, #9c27b0 100%); color: white; font-weight: 500; }
    .graduation { background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%); color: #333; font-weight: 600; text-align: center; }

    .alert-message {
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        font-weight: 500;
    }

    .alert-success {
        background: #e6f4ea;
        color: #137333;
        border-left: 4px solid #34a853;
    }

    .alert-error {
        background: #fce8e6;
        color: #d93025;
        border-left: 4px solid #ea4335;
    }

    .alert-warning {
        background: #fef7e0;
        color: #f9ab00;
        border-left: 4px solid #fbbc04;
    }

    @media (max-width: 768px) {
        #calendario-generator-app {
            padding: 10px;
        }
        
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .button-container, .view-controls {
            flex-direction: column;
        }
        
        .day-view .date-column {
            width: 140px;
            font-size: 0.9em;
        }
        
        .day-view .activity-column {
            font-size: 0.85em;
        }
        
        .week-view .week-grid {
            grid-template-columns: 1fr;
        }
        
        .course-buttons {
            flex-direction: column;
        }
    }
</style>

<!-- HEADER -->
<div class="header-section">
    <h1>üéì Generador de Calendarios M√©dicos</h1>
    <p>Sistema Profesional de Gesti√≥n de Cursos - Versi√≥n Completa</p>
</div>

<!-- FORMULARIO -->
<div class="form-container">
    <h2 class="form-title">üìù Crear Nuevo Curso</h2>
    
    <div class="form-grid">
        <div class="input-wrapper">
            <label for="courseName">Nombre del Curso:</label>
            <input type="text" id="courseName" placeholder="Ej: Curso de Ultrasonido 2025">
        </div>
        <div class="input-wrapper">
            <label for="startDate">Fecha de Inicio:</label>
            <input type="date" id="startDate">
        </div>
        <div class="input-wrapper">
            <label for="instructor">Instructor:</label>
            <input type="text" id="instructor" placeholder="Nombre del instructor">
        </div>
    </div>

    <div class="button-container">
        <button class="google-btn btn-primary" onclick="generateCalendar()">
            üìÖ Generar Calendario
        </button>
        <button class="google-btn btn-secondary" onclick="saveCourse()">
            üíæ Guardar Curso
        </button>
        <button class="google-btn btn-success" onclick="exportCalendar()">
            üñ®Ô∏è Imprimir
        </button>
    </div>

    <div id="alertArea"></div>
</div>

<!-- CURSOS GUARDADOS -->
<div class="saved-section">
    <h2>üìö Cursos Guardados</h2>
    <div id="coursesList">
        <p style="color: #5f6368; font-style: italic;">No hay cursos guardados. Crea tu primer curso arriba.</p>
    </div>
</div>

<!-- CALENDARIO -->
<div class="calendar-display" id="calendarArea">
    <div class="calendar-header">
        <h1 id="calendarTitle">üìÖ Calendario del Curso</h1>
        <div id="calendarDetails" class="calendar-info"></div>
        
        <!-- INFORMACI√ìN DE SEMANAS -->
        <div class="week-info" id="weekInfo" style="display: none;">
            <div class="week-numbers">
                <div class="week-number" id="diplomadoWeek">Semana 1 del Diplomado</div>
                <div class="week-number" id="yearWeek">Semana 35 del A√±o</div>
            </div>
        </div>
        
        <!-- CONTROLES DE VISTA -->
        <div class="view-controls">
            <button class="view-btn active" onclick="switchView('day')">üìÖ Vista por D√≠as</button>
            <button class="view-btn" onclick="switchView('week')">üìä Vista por Semanas</button>
            <button class="view-btn" onclick="switchView('month')">üìà Vista por Meses</button>
        </div>
    </div>
    
    <!-- VISTA POR D√çAS -->
    <div id="dayView" class="day-view">
        <div id="calendarData"></div>
    </div>
    
    <!-- VISTA POR SEMANAS -->
    <div id="weekView" class="week-view">
        <div id="weekData"></div>
    </div>
    
    <!-- VISTA POR MESES -->
    <div id="monthView" class="month-view">
        <div id="monthData"></div>
    </div>
</div>

<script>
// Estructura del curso con eventos especiales marcados
const courseModules = [
    ...Array(8).fill().map((_, i) => `M√≥dulo 1. Introducci√≥n D${i + 1}`),
    ...Array(11).fill().map((_, i) => `M√≥dulo 2. Renal D${i + 1}`),
    '1ra Intervenci√≥n Entrenamiento Continuo',
    ...Array(14).fill().map((_, i) => `M√≥dulo 3. Genitourinario D${i + 1}`),
    '2da Intervenci√≥n Entrenamiento Continuo',
    ...Array(23).fill().map((_, i) => `M√≥dulo 4. Mama D${i + 1}`),
    ...Array(20).fill().map((_, i) => `M√≥dulo 5. Abdomen D${i + 1}`),
    '3ra Intervenci√≥n Entrenamiento Continuo',
    ...Array(25).fill().map((_, i) => `M√≥dulo 6. Obstetricia D${i + 1}`),
    '4ta Intervenci√≥n Entrenamiento Continuo',
    'Taller botoneria',
    ...Array(7).fill().map((_, i) => `M√≥dulo 7. Tejidos blandos D${i + 1}`),
    'Taller de cierre mama D1',
    'Taller de cierre mama D2',
    ...Array(11).fill().map((_, i) => `M√≥dulo 8. Cabeza y cuello D${i + 1}`),
    '5ta Intervenci√≥n Entrenamiento Continuo',
    'Curso ACLS',
    ...Array(5).fill().map((_, i) => `M√≥dulo 9. Correlaci√≥n clinica D${i + 1}`),
    ...Array(2).fill().map((_, i) => `M√≥dulo 10. Multimodal D${i + 1}`),
    'Evaluaci√≥n final Entrenamiento Continuo D1',
    'Evaluaci√≥n final Entrenamiento Continuo D2',
    ...Array(10).fill().map((_, i) => `Practicas finales D${i + 1}`),
    'Inducci√≥n D1',
    'Inducci√≥n D2',
    'Inducci√≥n D3',
    'Graduaci√≥n'
];

// Eventos que NO pueden solaparse
const nonOverlapEvents = [
    'Intervenci√≥n Entrenamiento Continuo',
    'Taller de cierre mama',
    'Curso ACLS',
    'Taller botoneria',
    'Inducci√≥n',
    'Graduaci√≥n'
];

let savedCourses = JSON.parse(localStorage.getItem('medicalCourses') || '[]');
let currentCourse = null;
let currentView = 'day';

// Cargar cursos al inicio
document.addEventListener('DOMContentLoaded', loadSavedCourses);

function generateCalendar() {
    const name = document.getElementById('courseName').value;
    const start = document.getElementById('startDate').value;
    const instructor = document.getElementById('instructor').value;

    if (!name || !start) {
        showMessage('Por favor completa el nombre del curso y la fecha de inicio.', 'error');
        return;
    }

    try {
        const schedule = createScheduleWithConstraints(new Date(start));
        
        currentCourse = {
            name,
            startDate: start,
            instructor,
            schedule,
            endDate: schedule[schedule.length - 1].date.toISOString().split('T')[0]
        };

        showCalendar(currentCourse);
        showMessage('‚úÖ Calendario generado con todas las restricciones aplicadas!', 'success');
    } catch (error) {
        showMessage('‚ùå Error al generar el calendario: ' + error.message, 'error');
    }
}

function createScheduleWithConstraints(startDate) {
    // Generar secuencia b√°sica
    let schedule = [];
    let currentDate = new Date(startDate);
    let moduleIndex = 0;

    while (moduleIndex < courseModules.length) {
        if (currentDate.getDay() >= 1 && currentDate.getDay() <= 5) {
            const diplomadoWeek = Math.floor(moduleIndex / 5) + 1;
            const yearWeek = getWeekOfYear(currentDate);
            
            schedule.push({
                date: new Date(currentDate),
                activity: courseModules[moduleIndex],
                dayOfWeek: currentDate.getDay(),
                moduleIndex: moduleIndex,
                diplomadoWeek: diplomadoWeek,
                yearWeek: yearWeek
            });
            moduleIndex++;
        }
        currentDate.setDate(currentDate.getDate() + 1);
    }

    return applySpecialConstraintsNoOverlap(schedule);
}

function applySpecialConstraintsNoOverlap(schedule) {
    const adjusted = [...schedule];
    let warnings = [];
    
    const specialEvents = findSpecialEvents(adjusted);
    
    // Ajustar intervenciones a viernes
    specialEvents.interventions.forEach(index => {
        const originalDate = adjusted[index].date;
        const fridayDate = findNextAvailableWeekday(originalDate, 5, adjusted, index);
        
        if (fridayDate.getTime() !== originalDate.getTime()) {
            warnings.push(`Intervenci√≥n ${index + 1} movida a ${formatDate(fridayDate)} para cumplir restricci√≥n de viernes`);
        }
        
        adjusted[index].date = fridayDate;
        adjusted[index].dayOfWeek = 5;
        adjusted[index].yearWeek = getWeekOfYear(fridayDate);
    });

    // Ajustar inducci√≥n a lunes-martes-mi√©rcoles consecutivos
    if (specialEvents.inductionDays.length >= 3) {
        const baseDate = adjusted[specialEvents.inductionDays[0]].date;
        const mondayDate = findNextAvailableInductionWeek(baseDate, adjusted, specialEvents.inductionDays);
        
        specialEvents.inductionDays.forEach((index, i) => {
            const inductionDate = new Date(mondayDate);
            inductionDate.setDate(mondayDate.getDate() + i);
            adjusted[index].date = inductionDate;
            adjusted[index].dayOfWeek = inductionDate.getDay();
            adjusted[index].yearWeek = getWeekOfYear(inductionDate);
        });
    }

    // Ajustar graduaci√≥n a jueves
    if (specialEvents.graduationIndex >= 0 && specialEvents.inductionDays.length > 0) {
        const lastInductionDate = adjusted[specialEvents.inductionDays[specialEvents.inductionDays.length - 1]].date;
        const graduationDate = new Date(lastInductionDate);
        graduationDate.setDate(lastInductionDate.getDate() + 1);
        adjusted[specialEvents.graduationIndex].date = graduationDate;
        adjusted[specialEvents.graduationIndex].dayOfWeek = 4;
        adjusted[specialEvents.graduationIndex].yearWeek = getWeekOfYear(graduationDate);
    }

    if (warnings.length > 0) {
        showMessage('‚ö†Ô∏è Ajustes realizados: ' + warnings.join('; '), 'warning');
    }

    return recalculateDiplomadoWeeks(adjusted.sort((a, b) => a.date - b.date));
}

function findSpecialEvents(schedule) {
    const interventions = [];
    const inductionDays = [];
    let graduationIndex = -1;

    schedule.forEach((day, index) => {
        if (day.activity.includes('Intervenci√≥n Entrenamiento Continuo')) {
            interventions.push(index);
        } else if (day.activity.includes('Inducci√≥n')) {
            inductionDays.push(index);
        } else if (day.activity.includes('Graduaci√≥n')) {
            graduationIndex = index;
        }
    });

    return { interventions, inductionDays, graduationIndex };
}

function findNextAvailableWeekday(fromDate, targetDay, schedule, excludeIndex) {
    let date = new Date(fromDate);
    let attempts = 0;
    const maxAttempts = 14;
    
    while (attempts < maxAttempts) {
        const currentDay = date.getDay();
        let daysToAdd = targetDay - currentDay;
        
        if (daysToAdd <= 0) daysToAdd += 7;
        
        date.setDate(date.getDate() + daysToAdd);
        
        if (isDateAvailable(date, schedule, excludeIndex)) {
            return new Date(date);
        }
        
        date.setDate(date.getDate() + 7);
        attempts++;
    }
    
    return findNextWeekday(fromDate, targetDay);
}

function findNextAvailableInductionWeek(fromDate, schedule, excludeIndices) {
    let date = new Date(fromDate);
    let attempts = 0;
    const maxAttempts = 8;
    
    while (attempts < maxAttempts) {
        const mondayDate = findNextWeekday(date, 1);
        
        const monday = new Date(mondayDate);
        const tuesday = new Date(mondayDate);
        tuesday.setDate(monday.getDate() + 1);
        const wednesday = new Date(mondayDate);
        wednesday.setDate(monday.getDate() + 2);
        
        if (isDateAvailable(monday, schedule, exclu
